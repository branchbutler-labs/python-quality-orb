description: >
  Format Python code with Black and isort.

  This command automatically formats your Python code according to Black's
  opinionated style and sorts imports using isort. Optionally commits and
  pushes the changes to the current branch.

parameters:
  line-length:
    type: integer
    default: 100
    description: Maximum line length for Black formatter

  auto-commit:
    type: boolean
    default: true
    description: Automatically commit and push formatting changes

  paths:
    type: string
    default: "."
    description: Paths to format (space-separated)

  isort-profile:
    type: string
    default: "black"
    description: isort profile to use (black, django, pycharm, google, open_stack, plone, attrs, hug)

steps:
  - run:
      name: Install formatters
      command: |
        pip install black isort

  - run:
      name: Run Black formatter
      command: |
        echo "Formatting with Black (line length: << parameters.line-length >>)"
        black --line-length << parameters.line-length >> --check --diff << parameters.paths >> || true
        black --line-length << parameters.line-length >> << parameters.paths >>

  - run:
      name: Run isort
      command: |
        echo "Sorting imports with isort"
        isort --profile << parameters.isort-profile >> --check --diff << parameters.paths >> || true
        isort --profile << parameters.isort-profile >> << parameters.paths >>

  - when:
      condition: << parameters.auto-commit >>
      steps:
        - run:
            name: Commit formatting changes
            command: |
              git config user.email "bot@branchbutler.com"
              git config user.name "Branch Butler Bot"

              if [[ -n $(git status --porcelain) ]]; then
                git add .
                git commit -m "style: apply code formatting [skip ci]

              - Applied Black formatter (line length: << parameters.line-length >>)
              - Sorted imports with isort

              ðŸ¤– Generated by Branch Butler"

                git push origin HEAD
                echo "âœ… Formatting changes committed and pushed"
              else
                echo "âœ… No formatting changes needed"
              fi
